image: Visual Studio 2017

configuration:
  - release

install:
  - set QTDIR=C:\Qt\5.11.0\msvc2017_64
  - set PATH=%QTDIR%\bin;%PATH%
  - set PATH=C:\Qt\Tools\QtCreator\bin;%PATH%

before_build:
 - cd %APPVEYOR_BUILD_FOLDER%
 - git submodule update --init --recursive
 - call "%ProgramFiles(x86)%\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x64
 - mkdir %APPVEYOR_BUILD_FOLDER%-build
 - cd %APPVEYOR_BUILD_FOLDER%-build
 - qmake -o %APPVEYOR_BUILD_FOLDER%-build -r -Wall -spec win32-msvc CONFIG+=%CONFIGURATION% %APPVEYOR_BUILD_FOLDER%/Gui && jom qmake_all

build_script:
  - cd %APPVEYOR_BUILD_FOLDER%-build
  - jom
  - jom install
  - windeployqt.exe "./app/release/DNAI.exe" -qmldir=%APPVEYOR_BUILD_FOLDER%\Gui\app\resources -verbose=2
  - copy "%ProgramFiles(x86)%\Microsoft Visual Studio\2017\Enterprise\VC\Redist\MSVC\14.13.26020\x64\Microsoft.VC141.CRT\*" "./app/release/"
  - copy "%ProgramFiles(x86)%\Microsoft Visual Studio\2017\Enterprise\VC\Redist\MSVC\14.13.26020\x64\Microsoft.VC141.CXXAMP\*" "./app/release/"
  - copy "%ProgramFiles(x86)%\Microsoft Visual Studio\2017\Enterprise\VC\Redist\MSVC\14.13.26020\x64\Microsoft.VC141.OpenMP\*" "./app/release/"
  - RENAME "app/release" "DNAI"
  - move "app/DNAI" "./"
