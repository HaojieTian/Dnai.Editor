language: cpp

sudo: required
compiler: clang
os: osx

cache:
  directories:
    - ~/Qt/
    
before_script:
  - export QTDIR=~/Qt/5.10.1/clang_64
  - export PATH=$QTDIR/bin:$PATH
  - brew install lcov
  - brew install python3
  - curl -O http://python-distribute.org/distribute_setup.py
  - python distribute_setup.py
  - curl -O https://raw.github.com/pypa/pip/master/contrib/get-pip.py
  - python get-pip.py
  - sudo pip install codecov


script:
  - if [ ! -e ~/Qt/5.10.1/ ] ; then
      wget https://download.qt.io/official_releases/qt/5.10/5.10.1/qt-opensource-mac-x64-5.10.1.dmg;
      sudo hdiutil attach -noverify ./qt-opensource-mac-x64-5.10.1.dmg;
      /Volumes/qt-opensource-mac-x64-5.10.1/qt-opensource-mac-x64-5.10.1.app/Contents/MacOS/qt-opensource-mac-x64-5.10.1 --platform minimal --script qt_script_osx.qs;
    fi
  - git submodule update --init --recursive
  - cd Gui
  - qmake DNAI.pro
  - make debug
  - ./app/DNAI.app/Contents/MacOS/DNAI --profile
  - ./get_code_cov
  - codecov
  - cd ../Server
  - qmake Server.pro
  - make

after_success:
  - bash <(curl -s https://codecov.io/bash)
